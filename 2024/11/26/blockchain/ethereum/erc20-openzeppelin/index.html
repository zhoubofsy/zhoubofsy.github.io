<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhoubofsy.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="这是一段openzeppelin官方生成的代码 12345678910111213141516171819202122232425262728293031323334353637&#x2F;&#x2F; SPDX-License-Identifier: MIT&#x2F;&#x2F; Compatible with OpenZeppelin Contracts ^5.0.0pragma solidity ^0.8.22;import &amp;">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenZeppelin ERC-20 详解">
<meta property="og:url" content="http://zhoubofsy.github.io/2024/11/26/blockchain/ethereum/erc20-openzeppelin/index.html">
<meta property="og:site_name" content="Bolog">
<meta property="og:description" content="这是一段openzeppelin官方生成的代码 12345678910111213141516171819202122232425262728293031323334353637&#x2F;&#x2F; SPDX-License-Identifier: MIT&#x2F;&#x2F; Compatible with OpenZeppelin Contracts ^5.0.0pragma solidity ^0.8.22;import &amp;">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-11-26T03:08:25.000Z">
<meta property="article:modified_time" content="2024-11-28T03:04:23.081Z">
<meta property="article:author" content="博">
<meta property="article:tag" content="ethereum">
<meta property="article:tag" content="solidity">
<meta property="article:tag" content="openzeppelin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://zhoubofsy.github.io/2024/11/26/blockchain/ethereum/erc20-openzeppelin/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>OpenZeppelin ERC-20 详解 | Bolog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Bolog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://zhoubofsy.github.io/2024/11/26/blockchain/ethereum/erc20-openzeppelin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="博">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bolog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          OpenZeppelin ERC-20 详解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-11-26 11:08:25" itemprop="dateCreated datePublished" datetime="2024-11-26T11:08:25+08:00">2024-11-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-28 11:04:23" itemprop="dateModified" datetime="2024-11-28T11:04:23+08:00">2024-11-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/blockchain/" itemprop="url" rel="index"><span itemprop="name">blockchain</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>这是一段<code>openzeppelin</code>官方生成的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">// Compatible with OpenZeppelin Contracts ^5.0.0</span><br><span class="line">pragma solidity ^0.8.22;</span><br><span class="line"></span><br><span class="line">import &#123;AccessManaged&#125; from &quot;@openzeppelin/contracts/access/manager/AccessManaged.sol&quot;;</span><br><span class="line">import &#123;ERC20&#125; from &quot;@openzeppelin/contracts/token/ERC20/ERC20.sol&quot;;</span><br><span class="line">import &#123;ERC20Pausable&#125; from &quot;@openzeppelin/contracts/token/ERC20/extensions/ERC20Pausable.sol&quot;;</span><br><span class="line">import &#123;ERC20Permit&#125; from &quot;@openzeppelin/contracts/token/ERC20/extensions/ERC20Permit.sol&quot;;</span><br><span class="line"></span><br><span class="line">contract BobToken is ERC20, ERC20Pausable, AccessManaged, ERC20Permit &#123;</span><br><span class="line">    constructor(address initialAuthority)</span><br><span class="line">        ERC20(&quot;BobToken&quot;, &quot;BBK&quot;)</span><br><span class="line">        AccessManaged(initialAuthority)</span><br><span class="line">        ERC20Permit(&quot;BobToken&quot;)</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    function pause() public restricted &#123;</span><br><span class="line">        _pause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function unpause() public restricted &#123;</span><br><span class="line">        _unpause();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function mint(address to, uint256 amount) public restricted &#123;</span><br><span class="line">        _mint(to, amount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // The following functions are overrides required by Solidity.</span><br><span class="line"></span><br><span class="line">    function _update(address from, address to, uint256 value)</span><br><span class="line">         internal</span><br><span class="line">         override(ERC20, ERC20Pausable)</span><br><span class="line">    &#123;</span><br><span class="line">         super._update(from, to, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码定义了一个名为<code>BobToken</code>的智能合约，它继承了多个标准接口和合约，用于创建一个可暂停、可授权管理、可使用EIP-2612标准的许可（Permit）功能的代币。下面是对代码的详细解释：</p>
<h3 id="继承的合约和接口"><a href="#继承的合约和接口" class="headerlink" title="继承的合约和接口"></a>继承的合约和接口</h3><ol>
<li><strong>ERC20</strong>: ERC20是一个标准接口，定义了代币的基本功能，如总供应量、余额查询、转账等。</li>
<li><strong>ERC20Pausable</strong>: 这个接口允许代币的转账操作被暂停，从而防止在特定情况下（如紧急情况）的代币转移。</li>
<li><strong>AccessManaged</strong>: 这个接口可能定义了访问控制功能，比如只有特定地址（如管理员）才能执行某些操作。</li>
<li><strong>ERC20Permit</strong>: 这个接口允许代币持有者通过签名授权来批准第三方转移代币，而不需要直接调用转账函数。</li>
</ol>
<h4 id="继承顺序"><a href="#继承顺序" class="headerlink" title="继承顺序"></a>继承顺序</h4><p>在Solidity中，合约的继承顺序是从左到右的，即最左边的合约是基类，最右边的合约是派生类。例如，在contract BobToken is ERC20, ERC20Pausable, AccessManaged, ERC20Permit {}中，BobToken继承了ERC20、ERC20Pausable、AccessManaged和ERC20Permit。</p>
<h4 id="继承原则"><a href="#继承原则" class="headerlink" title="继承原则"></a>继承原则</h4><ol>
<li><strong>从左到右的继承顺序</strong>：如上所述，继承顺序是从左到右的，这意味着基类在派生类之前被继承。</li>
<li><strong>构造函数的调用</strong>：在派生类的构造函数中，必须显式地调用所有基类的构造函数。调用顺序必须遵循继承顺序，即从左到右。</li>
<li><strong>函数覆盖</strong>：如果基类和派生类中有同名的函数，那么派生类的函数会覆盖基类的函数。在调用这些函数时，会优先调用派生类的函数。</li>
<li><strong>库的使用</strong>：如果合约继承了一个库，那么库的函数会被覆盖。这是因为库的函数是内部函数，不能被覆盖。</li>
</ol>
<h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">constructor(address initialAuthority)</span><br><span class="line">    ERC20(&quot;BobToken&quot;, &quot;BBK&quot;)</span><br><span class="line">    AccessManaged(initialAuthority)</span><br><span class="line">    ERC20Permit(&quot;BobToken&quot;)</span><br><span class="line">&#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>initialAuthority</code>: 初始化合约的管理权限地址。</li>
<li>构造函数中调用了多个基类的构造函数，传递了必要的参数，如代币名称、符号、初始权限地址等。ERC20、AccessManaged和ERC20Permit的构造函数被显式地调用，并且按照继承顺序从左到右调用。</li>
</ul>
<h3 id="主要函数"><a href="#主要函数" class="headerlink" title="主要函数"></a>主要函数</h3><ol>
<li><strong>pause()</strong>: 暂停代币的转账操作。只有通过<code>AccessManaged</code>接口授权的地址才能调用。</li>
<li><strong>unpause()</strong>: 恢复代币的转账操作。同样，只有授权的地址才能调用。</li>
<li><strong>mint(address to, uint256 amount)</strong>: 允许授权地址铸造新的代币，并将其发送给指定的地址。这通常用于代币发行。</li>
</ol>
<h3 id="内部函数"><a href="#内部函数" class="headerlink" title="内部函数"></a>内部函数</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function _update(address from, address to, uint256 value)</span><br><span class="line">    internal</span><br><span class="line">    override(ERC20, ERC20Pausable)</span><br><span class="line">&#123;</span><br><span class="line">    super._update(from, to, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>_update</code>函数是一个内部函数，用于更新代币的余额。它重写了<code>ERC20</code>和<code>ERC20Pausable</code>中的同名函数，并在内部调用了<code>super._update</code>，确保了在更新余额时考虑了暂停状态。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><strong>访问控制</strong>: <code>AccessManaged</code>接口确保了只有授权的地址才能执行关键操作，如暂停、铸造等。</li>
<li><strong>暂停功能</strong>: <code>ERC20Pausable</code>接口提供了暂停和恢复转账操作的功能，这在处理紧急情况时非常有用。</li>
<li><strong>EIP-2612 Permit标准</strong>: 通过实现<code>ERC20Permit</code>接口，用户可以授权第三方代币转移，而无需直接调用转账函数，这提高了安全性。</li>
</ul>
<p>总的来说，这段代码实现了一个功能丰富的代币合约，结合了多种安全性和管理功能，适用于需要严格控制访问和操作的场景。接下来，我们按照继承顺序逐个来介绍一下。</p>
<h1 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">// OpenZeppelin Contracts (last updated v5.0.1) (utils/Context.sol)</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.8.20;</span><br><span class="line"></span><br><span class="line">abstract contract Context &#123;</span><br><span class="line">    function _msgSender() internal view virtual returns (address) &#123;</span><br><span class="line">        return msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function _msgData() internal view virtual returns (bytes calldata) &#123;</span><br><span class="line">        return msg.data;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function _contextSuffixLength() internal view virtual returns (uint256) &#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码定义了一个名为<code>Context</code>的抽象合约。这个合约主要用于提供关于当前执行上下文的信息，包括交易的发送者和数据。在处理元交易（meta-transactions）时，发送和支付执行费用的账户可能不是实际的应用程序发送者。</p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><ol>
<li><p><strong><code>_msgSender()</code>函数</strong>：这个函数返回当前交易的发送者地址。在大多数情况下，这可以通过<code>msg.sender</code>直接获取，但在处理元交易时，这个值可能不是实际的发送者。因此，这个函数提供了一个抽象层，允许子合约重写它以提供正确的发送者地址。</p>
</li>
<li><p><strong><code>_msgData()</code>函数</strong>：这个函数返回当前交易的输入数据。同样，在大多数情况下，这可以通过<code>msg.data</code>直接获取，但在处理元交易时，这个值可能不是实际的输入数据。因此，这个函数提供了一个抽象层，允许子合约重写它以提供正确的输入数据。</p>
</li>
<li><p><strong><code>_contextSuffixLength()</code>函数</strong>：这个函数返回一个长度值，表示上下文后缀的长度。这个函数在处理元交易时可能有用，但在这个合约中默认返回0，表示没有上下文后缀。</p>
</li>
</ol>
<h3 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h3><p><code>Context</code>合约的主要用途是为那些需要访问当前执行上下文信息的合约提供基础。例如，如果一个合约需要知道是谁发送了交易，或者交易中包含了哪些数据，它可以继承<code>Context</code>合约并使用<code>_msgSender()</code>和<code>_msgData()</code>函数。</p>
<h3 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><strong>继承</strong>：任何需要使用<code>Context</code>合约功能的合约都应该继承它。如果子合约需要提供不同的发送者或数据，它应该重写<code>_msgSender()</code>和<code>_msgData()</code>函数。</li>
<li><strong>元交易</strong>：处理元交易时，发送和支付执行费用的账户可能不是实际的发送者。因此，任何依赖于<code>msg.sender</code>或<code>msg.data</code>的合约都需要能够处理这种情况。</li>
<li><strong>安全性</strong>：在重写<code>_msgSender()</code>和<code>_msgData()</code>函数时，需要确保提供的信息是安全的，以防止潜在的安全漏洞。</li>
</ul>
<h1 id="ERC20"><a href="#ERC20" class="headerlink" title="ERC20"></a>ERC20</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">// OpenZeppelin Contracts (last updated v5.1.0) (token/ERC20/ERC20.sol)</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.8.20;</span><br><span class="line"></span><br><span class="line">import &#123;IERC20&#125; from &quot;./IERC20.sol&quot;;</span><br><span class="line">import &#123;IERC20Metadata&#125; from &quot;./extensions/IERC20Metadata.sol&quot;;</span><br><span class="line">import &#123;Context&#125; from &quot;../../utils/Context.sol&quot;;</span><br><span class="line">import &#123;IERC20Errors&#125; from &quot;../../interfaces/draft-IERC6093.sol&quot;;</span><br><span class="line"></span><br><span class="line">abstract contract ERC20 is Context, IERC20, IERC20Metadata, IERC20Errors &#123;</span><br><span class="line"> ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>定义了一个名为 ERC20 的抽象合约，它继承了四个接口：Context、IERC20、IERC20Metadata 和 IERC20Errors。</p>
<ol>
<li>abstract contract ERC20</li>
</ol>
<ul>
<li>abstract contract 表示这是一个抽象合约，不能直接实例化。它通常用于定义接口和共享逻辑，其他合约可以继承它。</li>
<li>ERC20 是合约的名称。</li>
</ul>
<ol start="2">
<li>is Context, IERC20, IERC20Metadata, IERC20Errors</li>
</ol>
<ul>
<li>Context 是一个包含上下文相关函数（如 msg.sender）的接口，通常用于简化合约编写。</li>
<li>IERC20 是 ERC20 标准的接口，定义了 ERC20 代币的基本功能，如 totalSupply、balanceOf、transfer 等。</li>
<li>IERC20Metadata 是 ERC20 标准的扩展接口，定义了代币的元数据，如 name、symbol 和 decimals。</li>
<li>IERC20Errors 是一个自定义的接口，通常用于定义合约中可能出现的错误，如 TransferFailedError、InsufficientBalanceError 等。</li>
</ul>
<h3 id="合约成员"><a href="#合约成员" class="headerlink" title="合约成员"></a>合约成员</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mapping(address account =&gt; uint256) private _balances;</span><br><span class="line"></span><br><span class="line">mapping(address account =&gt; mapping(address spender =&gt; uint256)) private _allowances;</span><br><span class="line"></span><br><span class="line">uint256 private _totalSupply;</span><br><span class="line"></span><br><span class="line">string private _name;</span><br><span class="line">string private _symbol;</span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong>_balances</strong>:</p>
<ul>
<li>这是一个映射（mapping），用于存储每个账户的代币余额。</li>
<li><code>address account</code> 是账户地址，<code>uint256</code> 是该地址对应的代币数量。</li>
<li><code>private</code> 关键字表示这个映射只能在合约内部访问，外部无法直接访问。</li>
<li>这个映射用于跟踪每个账户的代币余额。</li>
</ul>
</li>
<li><p><strong>_allowances</strong>:</p>
<ul>
<li>这是一个嵌套的映射，用于存储每个账户授权给其他账户的代币数量。</li>
<li><code>address account</code> 是账户地址，<code>mapping(address spender =&gt; uint256)</code> 是一个映射，表示该账户授权给其他账户的代币数量。</li>
<li><code>address spender</code> 是被授权的账户地址，<code>uint256</code> 是被授权的代币数量。</li>
<li><code>private</code> 关键字表示这个映射只能在合约内部访问，外部无法直接访问。</li>
<li>这个映射用于跟踪每个账户授权给其他账户的代币数量，通常用于实现代币的转账授权功能。<br>  -</li>
</ul>
</li>
<li><p><strong>_totalSupply</strong>:</p>
<ul>
<li>这是一个无符号整数（uint256），用于存储代币的总供应量。</li>
<li><code>private</code> 关键字表示这个变量只能在合约内部访问，外部无法直接访问。</li>
<li>这个变量用于跟踪代币的总供应量。<br>  -</li>
</ul>
</li>
<li><p><strong>_name</strong>:</p>
<ul>
<li>这是一个字符串变量，用于存储代币的名称。</li>
<li><code>private</code> 关键字表示这个变量只能在合约内部访问，外部无法直接访问。</li>
<li>这个变量用于存储代币的名称，例如 “MyToken”。</li>
</ul>
</li>
<li><p><strong>_symbol</strong>:</p>
<ul>
<li>这是一个字符串变量，用于存储代币的符号。</li>
<li><code>private</code> 关键字表示这个变量只能在合约内部访问，外部无法直接访问。</li>
<li>这个变量用于存储代币的符号，例如 “MTK”。</li>
</ul>
</li>
</ol>
<h3 id="transfer-transferFrom"><a href="#transfer-transferFrom" class="headerlink" title="transfer &amp; transferFrom"></a>transfer &amp; transferFrom</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">function transfer(address to, uint256 value) public virtual returns (bool) &#123;</span><br><span class="line">    address owner = _msgSender();</span><br><span class="line">    _transfer(owner, to, value);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function transferFrom(address from, address to, uint256 value) public virtual returns (bool) &#123;</span><br><span class="line">    address spender = _msgSender();</span><br><span class="line">    _spendAllowance(from, spender, value);</span><br><span class="line">    _transfer(from, to, value);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function _transfer(address from, address to, uint256 value) internal &#123;</span><br><span class="line">    if (from == address(0)) &#123;</span><br><span class="line">        revert ERC20InvalidSender(address(0));</span><br><span class="line">    &#125;</span><br><span class="line">    if (to == address(0)) &#123;</span><br><span class="line">        revert ERC20InvalidReceiver(address(0));</span><br><span class="line">    &#125;</span><br><span class="line">    _update(from, to, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function _update(address from, address to, uint256 value) internal virtual &#123;</span><br><span class="line">    if (from == address(0)) &#123;</span><br><span class="line">        // Overflow check required: The rest of the code assumes that totalSupply never overflows</span><br><span class="line">        _totalSupply += value;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        uint256 fromBalance = _balances[from];</span><br><span class="line">        if (fromBalance &lt; value) &#123;</span><br><span class="line">            revert ERC20InsufficientBalance(from, fromBalance, value);</span><br><span class="line">        &#125;</span><br><span class="line">        unchecked &#123;</span><br><span class="line">            // Overflow not possible: value &lt;= fromBalance &lt;= totalSupply.</span><br><span class="line">            _balances[from] = fromBalance - value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (to == address(0)) &#123;</span><br><span class="line">        unchecked &#123;</span><br><span class="line">            // Overflow not possible: value &lt;= totalSupply or value &lt;= fromBalance &lt;= totalSupply.</span><br><span class="line">            _totalSupply -= value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        unchecked &#123;</span><br><span class="line">            // Overflow not possible: balance + value is at most totalSupply, which we know fits into a uint256.</span><br><span class="line">            _balances[to] += value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    emit Transfer(from, to, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>所有的转让动作最终都由<code>_transfer</code>方法来完成。</li>
<li><code>_transfer</code>方法中统一判断地址的有效性，使用<code>revert</code>比<code>require</code>更节省gas。</li>
<li><code>ERC20InvalidSender</code>和<code>ERC20InvalidReceiver</code>都来自<code>IERC20Errors</code>接口。</li>
</ul>
<p><strong>_update</strong></p>
<p><code>_update</code> 为内部虚函数，用于更新代币合约中的余额和总供应量。它主要用于处理代币的转移操作，确保在转移过程中不会发生溢出或不足的情况。</p>
<ol>
<li><p><strong>参数说明</strong>：</p>
<ul>
<li><code>from</code>：代币的发送者地址。</li>
<li><code>to</code>：代币的接收者地址。</li>
<li><code>value</code>：转移的代币数量。</li>
</ul>
</li>
<li><p><strong>更新总供应量</strong>：</p>
<ul>
<li>如果 <code>from</code> 是 <code>address(0)</code>，表示这是一个铸造操作（minting），那么 <code>_totalSupply</code> 将增加 <code>value</code>。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function _mint(address account, uint256 value) internal &#123;</span><br><span class="line">    if (account == address(0)) &#123;</span><br><span class="line">        revert ERC20InvalidReceiver(address(0));</span><br><span class="line">    &#125;</span><br><span class="line">    _update(address(0), account, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>如果 <code>from</code> 不是 <code>address(0)</code>，表示这是一个转移操作（transfer），那么首先检查 <code>from</code> 的余额是否足够，如果足够，则从 <code>from</code> 的余额中减去 <code>value</code>。</li>
</ul>
</li>
<li><p><strong>更新接收者的余额</strong>：</p>
<ul>
<li>如果 <code>to</code> 是 <code>address(0)</code>，表示这是一个销毁操作（burning），那么 <code>_totalSupply</code> 将减少 <code>value</code>。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function _burn(address account, uint256 value) internal &#123;</span><br><span class="line">    if (account == address(0)) &#123;</span><br><span class="line">        revert ERC20InvalidSender(address(0));</span><br><span class="line">    &#125;</span><br><span class="line">    _update(account, address(0), value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>如果 <code>to</code> 不是 <code>address(0)</code>，表示这是一个转移操作，那么将 <code>value</code> 加到 <code>to</code> 的余额中。</li>
</ul>
</li>
<li><p><strong>防止溢出</strong>：</p>
<ul>
<li>使用 <code>unchecked</code> 关键字来处理可能的溢出情况，因为代码逻辑已经确保了不会发生溢出。</li>
<li>使用 <code>unchecked</code> 可以节省gas</li>
</ul>
</li>
<li><p><strong>触发事件</strong>：</p>
<ul>
<li>最后，通过 <code>emit Transfer(from, to, value);</code> 触发一个 <code>Transfer</code> 事件，记录这次转移操作。</li>
</ul>
</li>
</ol>
<h3 id="approve"><a href="#approve" class="headerlink" title="approve"></a>approve</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">function transferFrom(address from, address to, uint256 value) public virtual returns (bool) &#123;</span><br><span class="line">    address spender = _msgSender();</span><br><span class="line">    _spendAllowance(from, spender, value);</span><br><span class="line">    _transfer(from, to, value);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function _approve(address owner, address spender, uint256 value) internal &#123;</span><br><span class="line">    _approve(owner, spender, value, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function _approve(address owner, address spender, uint256 value, bool emitEvent) internal virtual &#123;</span><br><span class="line">    if (owner == address(0)) &#123;</span><br><span class="line">        revert ERC20InvalidApprover(address(0));</span><br><span class="line">    &#125;</span><br><span class="line">    if (spender == address(0)) &#123;</span><br><span class="line">        revert ERC20InvalidSpender(address(0));</span><br><span class="line">    &#125;</span><br><span class="line">    _allowances[owner][spender] = value;</span><br><span class="line">    if (emitEvent) &#123;</span><br><span class="line">        emit Approval(owner, spender, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function _spendAllowance(address owner, address spender, uint256 value) internal virtual &#123;</span><br><span class="line">    uint256 currentAllowance = allowance(owner, spender);</span><br><span class="line">    if (currentAllowance != type(uint256).max) &#123;</span><br><span class="line">        if (currentAllowance &lt; value) &#123;</span><br><span class="line">            revert ERC20InsufficientAllowance(spender, currentAllowance, value);</span><br><span class="line">        &#125;</span><br><span class="line">        unchecked &#123;</span><br><span class="line">            _approve(owner, spender, currentAllowance - value, false);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>_approve</code>函数</strong></p>
<p><code>_approve</code>函数用于更新一个账户对另一个账户的授权额度。如果<code>emitEvent</code>参数为<code>true</code>，还会触发一个<code>Approval</code>事件。</p>
<pre><code>- `owner`：授权额度所有者的地址。
- `spender`：被授权的账户地址。
- `value`：授权的额度。
- `emitEvent`：一个布尔值，决定是否触发`Approval`事件。
</code></pre>
<p><strong>流程</strong></p>
<ol>
<li>首先检查<code>owner</code>和<code>spender</code>是否为<code>address(0)</code>，如果是，则抛出异常<code>ERC20InvalidApprover</code>或<code>ERC20InvalidSpender</code>。</li>
<li>更新<code>_allowances</code>映射，将<code>owner</code>对<code>spender</code>的授权额度设置为<code>value</code>。</li>
<li>如果<code>emitEvent</code>为<code>true</code>，则触发<code>Approval</code>事件。</li>
</ol>
<p><strong><code>_spendAllowance</code>函数</strong></p>
<p><code>_spendAllowance</code>函数用于消耗<code>owner</code>对<code>spender</code>的授权额度。它不会更新授权额度，除非授权额度是有限的。如果授权额度不足，则会抛出异常。</p>
<pre><code>- `owner`：授权额度所有者的地址。
- `spender`：被授权的账户地址。
- `value`：要消费的额度。
</code></pre>
<p><strong>流程</strong></p>
<ol>
<li>获取<code>owner</code>对<code>spender</code>的当前授权额度。</li>
<li>如果当前授权额度不是无限（即不等于<code>type(uint256).max</code>），则检查当前授权额度是否足够消费<code>value</code>。</li>
<li>如果足够，则更新<code>owner</code>对<code>spender</code>的授权额度，减去<code>value</code>，并触发<code>Approval</code>事件（如果<code>emitEvent</code>为<code>true</code>）。</li>
</ol>
<h3 id="decimals"><a href="#decimals" class="headerlink" title="decimals"></a>decimals</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function decimals() public view virtual returns (uint8) &#123;</span><br><span class="line">    return 18;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认值是18， 如果想改变，只能重写<code>decimals()</code>这个方法。这种方法直接返回固定值的相比于使用成员变量存储的方式更省gas。</p>
<h1 id="ERC20Pausable"><a href="#ERC20Pausable" class="headerlink" title="ERC20Pausable"></a>ERC20Pausable</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">// OpenZeppelin Contracts (last updated v5.1.0) (token/ERC20/extensions/ERC20Pausable.sol)</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.8.20;</span><br><span class="line"></span><br><span class="line">import &#123;ERC20&#125; from &quot;../ERC20.sol&quot;;</span><br><span class="line">import &#123;Pausable&#125; from &quot;../../../utils/Pausable.sol&quot;;</span><br><span class="line"></span><br><span class="line">abstract contract ERC20Pausable is ERC20, Pausable &#123;</span><br><span class="line">    /**</span><br><span class="line">     * @dev See &#123;ERC20-_update&#125;.</span><br><span class="line">     *</span><br><span class="line">     * Requirements:</span><br><span class="line">     *</span><br><span class="line">     * - the contract must not be paused.</span><br><span class="line">    */</span><br><span class="line">    function _update(address from, address to, uint256 value) internal virtual override whenNotPaused &#123;</span><br><span class="line">        super._update(from, to, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ERC20Pausable</code> 是个抽象合约，它继承了 <code>ERC20</code> 和 <code>Pausable</code> 两个合约。<code>ERC20</code> 是一个标准的代币合约接口，而 <code>Pausable</code> 是一个用于暂停合约操作的合约。</p>
<h3 id="实现原理-1"><a href="#实现原理-1" class="headerlink" title="实现原理"></a>实现原理</h3><ol>
<li><p><strong>继承关系</strong>：<code>ERC20Pausable</code> 继承了 <code>ERC20</code> 和 <code>Pausable</code> 合约，这意味着它继承了 <code>ERC20</code> 的所有功能（如代币的创建、转移、余额查询等）以及 <code>Pausable</code> 的功能（如暂停和恢复合约操作）。</p>
</li>
<li><p><strong>抽象合约</strong>：<code>ERC20Pausable</code> 是一个抽象合约，因为它包含了一个未实现的函数 <code>_update</code>。</p>
</li>
<li><p><strong>函数重写</strong>：<code>_update</code> 函数重写了 <code>ERC20</code> 合约中的 <code>_update</code> 函数。这个函数在执行代币转移操作之前，会检查合约是否处于暂停状态。如果合约处于暂停状态，则不允许执行转移操作。</p>
</li>
<li><p><strong><code>whenNotPaused</code> 修饰器</strong>：<code>whenNotPaused</code> 是 <code>Pausable</code> 合约中的一个修饰器，用于确保在调用被修饰的函数时，合约不是暂停状态。如果合约是暂停状态，调用将被 revert（回滚）。</p>
</li>
</ol>
<h3 id="用途-1"><a href="#用途-1" class="headerlink" title="用途"></a>用途</h3><p><code>ERC20Pausable</code> 合约的主要用途是提供一个可暂停的代币合约，允许合约所有者或管理员在紧急情况下暂停代币的转移操作，以防止潜在的滥用或攻击。</p>
<h3 id="注意事项-2"><a href="#注意事项-2" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li><p><strong>实现 <code>_update</code> 函数</strong>：任何继承 <code>ERC20Pausable</code> 的合约都必须实现 <code>_update</code> 函数，以确保在执行代币转移操作时能够正确地检查合约是否处于暂停状态。</p>
</li>
<li><p><strong>合约暂停</strong>：合约暂停后，所有与代币转移相关的操作都将被阻止，直到合约被恢复。因此，合约所有者或管理员在暂停合约时应谨慎操作，以避免造成不必要的损失。</p>
</li>
<li><p><strong>安全性</strong>：虽然 <code>ERC20Pausable</code> 合约提供了一种暂停合约的方法，但它并不能防止所有潜在的安全问题。开发者仍需确保合约的其他部分（如访问控制、逻辑错误等）是安全的。</p>
</li>
</ol>
<h1 id="AccessManaged"><a href="#AccessManaged" class="headerlink" title="AccessManaged"></a>AccessManaged</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">// OpenZeppelin Contracts (last updated v5.1.0) (access/manager/AccessManaged.sol)</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.8.20;</span><br><span class="line"></span><br><span class="line">import &#123;IAuthority&#125; from &quot;./IAuthority.sol&quot;;</span><br><span class="line">import &#123;AuthorityUtils&#125; from &quot;./AuthorityUtils.sol&quot;;</span><br><span class="line">import &#123;IAccessManager&#125; from &quot;./IAccessManager.sol&quot;;</span><br><span class="line">import &#123;IAccessManaged&#125; from &quot;./IAccessManaged.sol&quot;;</span><br><span class="line">import &#123;Context&#125; from &quot;../../utils/Context.sol&quot;;</span><br><span class="line"></span><br><span class="line">abstract contract AccessManaged is Context, IAccessManaged &#123;</span><br><span class="line">    address private _authority;</span><br><span class="line"></span><br><span class="line">    bool private _consumingSchedule;</span><br><span class="line">    constructor(address initialAuthority) &#123;</span><br><span class="line">        _setAuthority(initialAuthority);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    modifier restricted() &#123;</span><br><span class="line">        _checkCanCall(_msgSender(), _msgData());</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /// @inheritdoc IAccessManaged</span><br><span class="line">    function authority() public view virtual returns (address) &#123;</span><br><span class="line">        return _authority;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    /// @inheritdoc IAccessManaged</span><br><span class="line">    function setAuthority(address newAuthority) public virtual &#123;</span><br><span class="line">        address caller = _msgSender();</span><br><span class="line">        if (caller != authority()) &#123;</span><br><span class="line">            revert AccessManagedUnauthorized(caller);</span><br><span class="line">        &#125;</span><br><span class="line">        if (newAuthority.code.length == 0) &#123;</span><br><span class="line">            revert AccessManagedInvalidAuthority(newAuthority);</span><br><span class="line">        &#125;</span><br><span class="line">        _setAuthority(newAuthority);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    /// @inheritdoc IAccessManaged</span><br><span class="line">    function isConsumingScheduledOp() public view returns (bytes4) &#123;</span><br><span class="line">        return _consumingSchedule ? this.isConsumingScheduledOp.selector : bytes4(0);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function _setAuthority(address newAuthority) internal virtual &#123;</span><br><span class="line">        _authority = newAuthority;</span><br><span class="line">        emit AuthorityUpdated(newAuthority);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function _checkCanCall(address caller, bytes calldata data) internal virtual &#123;</span><br><span class="line">        (bool immediate, uint32 delay) = AuthorityUtils.canCallWithDelay(</span><br><span class="line">            authority(),</span><br><span class="line">            caller,</span><br><span class="line">            address(this),</span><br><span class="line">            bytes4(data[0:4])</span><br><span class="line">        );</span><br><span class="line">        if (!immediate) &#123;</span><br><span class="line">            if (delay &gt; 0) &#123;</span><br><span class="line">                _consumingSchedule = true;</span><br><span class="line">                IAccessManager(authority()).consumeScheduledOp(caller, data);</span><br><span class="line">                _consumingSchedule = false;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                revert AccessManagedUnauthorized(caller);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>AccessManaged</code> 是个抽象合约，它继承了 <code>Context</code> 和 <code>IAccessManaged</code> 接口。这个合约的主要目的是管理合约的访问权限，确保只有授权的地址才能调用特定的函数。下面是对代码的详细解释：</p>
<h3 id="合约结构"><a href="#合约结构" class="headerlink" title="合约结构"></a>合约结构</h3><ol>
<li><p><strong>状态变量</strong>：</p>
<ul>
<li><code>_authority</code>：存储当前合约的授权地址。</li>
<li><code>_consumingSchedule</code>：一个布尔值，用于指示是否正在执行预定的操作。</li>
</ul>
</li>
<li><p><strong>构造函数</strong>：</p>
<ul>
<li><code>constructor(address initialAuthority)</code>：初始化合约，设置初始的授权地址。</li>
</ul>
</li>
<li><p><strong>修饰器</strong>：</p>
<ul>
<li><code>modifier restricted()</code>：限制函数的访问，确保只有授权的地址才能调用。这个修饰器通过调用 <code>_checkCanCall</code> 函数来检查调用者是否有权限。</li>
</ul>
</li>
<li><p><strong>接口实现</strong>：</p>
<ul>
<li><code>function authority() public view virtual returns (address)</code>：返回当前的授权地址。</li>
<li><code>function setAuthority(address newAuthority) public virtual</code>：设置新的授权地址。只有当前的授权地址才能调用这个函数。</li>
<li><code>function isConsumingScheduledOp() public view returns (bytes4)</code>：检查合约是否正在执行预定的操作。</li>
</ul>
</li>
<li><p><strong>内部函数</strong>：</p>
<ul>
<li><code>function _setAuthority(address newAuthority) internal virtual</code>：设置新的授权地址。这个函数没有访问限制，允许直接设置新的授权地址。</li>
<li><code>function _checkCanCall(address caller, bytes calldata data) internal virtual</code>：检查调用者是否有权限调用当前函数。如果调用者没有权限，则抛出异常。</li>
</ul>
</li>
</ol>
<h3 id="实现原理-2"><a href="#实现原理-2" class="headerlink" title="实现原理"></a>实现原理</h3><ul>
<li><strong>权限管理</strong>：通过 <code>_authority</code> 状态变量和 <code>restricted</code> 修饰器实现。只有 <code>_authority</code> 指定的地址才能调用被 <code>restricted</code> 修饰的函数。</li>
<li><strong>授权地址的设置</strong>：通过 <code>setAuthority</code> 函数设置新的授权地址，只有当前的授权地址才能调用这个函数。</li>
<li><strong>预定操作</strong>：通过 <code>_consumingSchedule</code> 和 <code>isConsumingScheduledOp</code> 函数管理预定的操作。如果合约正在执行预定的操作，<code>isConsumingScheduledOp</code> 函数会返回一个特定的函数选择器。</li>
</ul>
<h3 id="用途-2"><a href="#用途-2" class="headerlink" title="用途"></a>用途</h3><p>这个合约的主要用途是提供一个框架，用于管理合约的访问权限。通过设置授权地址，可以确保只有授权的地址才能调用合约的特定函数。这对于需要严格控制访问权限的合约非常有用，例如智能合约钱包或权限管理合约。</p>
<h3 id="注意事项-3"><a href="#注意事项-3" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><strong>安全性</strong>：在实现权限管理时，需要特别注意不要在 <code>receive()</code> 或 <code>fallback()</code> 函数上使用 <code>restricted</code> 修饰器，因为这些函数的调用方式可能导致权限检查失败。</li>
<li><strong>权限转移</strong>：通过 <code>setAuthority</code> 函数可以转移合约的权限，但只有当前的授权地址才能执行这个操作，这确保了权限的转移是可控的。</li>
<li><strong>预定操作</strong>：通过 <code>isConsumingScheduledOp</code> 函数可以检查合约是否正在执行预定的操作，这对于需要同步执行多个操作的合约非常有用。</li>
</ul>
<h1 id="ERC20Permit"><a href="#ERC20Permit" class="headerlink" title="ERC20Permit"></a>ERC20Permit</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">// OpenZeppelin Contracts (last updated v5.1.0) (token/ERC20/extensions/ERC20Permit.sol)</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.8.20;</span><br><span class="line"></span><br><span class="line">import &#123;IERC20Permit&#125; from &quot;./IERC20Permit.sol&quot;;</span><br><span class="line">import &#123;ERC20&#125; from &quot;../ERC20.sol&quot;;</span><br><span class="line">import &#123;ECDSA&#125; from &quot;../../../utils/cryptography/ECDSA.sol&quot;;</span><br><span class="line">import &#123;EIP712&#125; from &quot;../../../utils/cryptography/EIP712.sol&quot;;</span><br><span class="line">import &#123;Nonces&#125; from &quot;../../../utils/Nonces.sol&quot;;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> @dev Implementation of the ERC-20 Permit extension allowing approvals to be made via signatures, as defined in</span><br><span class="line"> * https://eips.ethereum.org/EIPS/eip-2612[ERC-2612].</span><br><span class="line"> *</span><br><span class="line"> * Adds the &#123;permit&#125; method, which can be used to change an account&#x27;s ERC-20 allowance (see &#123;IERC20-allowance&#125;) by</span><br><span class="line"> * presenting a message signed by the account. By not relying on `&#123;IERC20-approve&#125;`, the token holder account doesn&#x27;t</span><br><span class="line"> * need to send a transaction, and thus is not required to hold Ether at all.</span><br><span class="line"> */</span><br><span class="line">abstract contract ERC20Permit is ERC20, IERC20Permit, EIP712, Nonces &#123;</span><br><span class="line">    bytes32 private constant PERMIT_TYPEHASH =</span><br><span class="line">    keccak256(&quot;Permit(address owner,address spender,uint256 value,uint256 nonce,uint256 deadline)&quot;);</span><br><span class="line"> </span><br><span class="line">    /**</span><br><span class="line">     * @dev Permit deadline has expired.</span><br><span class="line">     */</span><br><span class="line">    error ERC2612ExpiredSignature(uint256 deadline);</span><br><span class="line"> </span><br><span class="line">    /**</span><br><span class="line">     * @dev Mismatched signature.</span><br><span class="line">     */</span><br><span class="line">    error ERC2612InvalidSigner(address signer, address owner);</span><br><span class="line"> </span><br><span class="line">    /**</span><br><span class="line">     * @dev Initializes the &#123;EIP712&#125; domain separator using the `name` parameter, and setting `version` to `&quot;1&quot;`.</span><br><span class="line">     *</span><br><span class="line">     * It&#x27;s a good idea to use the same `name` that is defined as the ERC-20 token name.</span><br><span class="line">     */</span><br><span class="line">    constructor(string memory name) EIP712(name, &quot;1&quot;) &#123;&#125;</span><br><span class="line">       </span><br><span class="line">    /**</span><br><span class="line">     * @inheritdoc IERC20Permit</span><br><span class="line">     */</span><br><span class="line">    function permit(</span><br><span class="line">        address owner,</span><br><span class="line">        address spender,</span><br><span class="line">        uint256 value,</span><br><span class="line">        uint256 deadline,</span><br><span class="line">        uint8 v,</span><br><span class="line">        bytes32 r,</span><br><span class="line">        bytes32 s</span><br><span class="line">    ) public virtual &#123;</span><br><span class="line">        if (block.timestamp &gt; deadline) &#123;</span><br><span class="line">            revert ERC2612ExpiredSignature(deadline);</span><br><span class="line">         &#125;</span><br><span class="line"> </span><br><span class="line">         bytes32 structHash = keccak256(abi.encode(PERMIT_TYPEHASH, owner, spender, value, _useNonce(owner), deadline));</span><br><span class="line"> </span><br><span class="line">         bytes32 hash = _hashTypedDataV4(structHash);</span><br><span class="line"> </span><br><span class="line">         address signer = ECDSA.recover(hash, v, r, s);</span><br><span class="line">         if (signer != owner) &#123;</span><br><span class="line">             revert ERC2612InvalidSigner(signer, owner);</span><br><span class="line">         &#125;</span><br><span class="line"> </span><br><span class="line">         _approve(owner, spender, value);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    /**</span><br><span class="line">     * @inheritdoc IERC20Permit</span><br><span class="line">     */</span><br><span class="line">    function nonces(address owner) public view virtual override(IERC20Permit, Nonces) returns (uint256) &#123;</span><br><span class="line">        return super.nonces(owner);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    /**</span><br><span class="line">     * @inheritdoc IERC20Permit</span><br><span class="line">     */</span><br><span class="line">    // solhint-disable-next-line func-name-mixedcase</span><br><span class="line">    function DOMAIN_SEPARATOR() external view virtual returns (bytes32) &#123;</span><br><span class="line">        return _domainSeparatorV4();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ERC20Permit</code> 是一个抽象合约，它结合了 ERC-20 标准和 ERC-2612 标准的功能。ERC-2612 标准允许使用签名来批准代币转移，而无需直接调用 <code>approve</code> 函数。下面是对代码的详细解释：</p>
<h3 id="实现原理-3"><a href="#实现原理-3" class="headerlink" title="实现原理"></a>实现原理</h3><ol>
<li><p><strong>继承关系</strong>：</p>
<ul>
<li><code>ERC20Permit</code> 继承了 <code>ERC20</code>、<code>IERC20Permit</code>、<code>EIP712</code> 和 <code>Nonces</code> 四个合约。</li>
<li><code>ERC20</code> 实现了 ERC-20 标准的代币功能。</li>
<li><code>IERC20Permit</code> 定义了 ERC-2612 标准的接口。</li>
<li><code>EIP712</code> 用于生成和验证 EIP-712 签名。</li>
<li><code>Nonces</code> 用于管理每个账户的签名计数器。</li>
</ul>
</li>
<li><p><strong>常量</strong>：</p>
<ul>
<li><code>PERMIT_TYPEHASH</code> 是一个哈希值，用于在 EIP-712 签名中标识 <code>Permit</code> 结构。</li>
</ul>
</li>
<li><p><strong>错误</strong>：</p>
<ul>
<li><code>ERC2612ExpiredSignature</code>：当签名过期时抛出。</li>
<li><code>ERC2612InvalidSigner</code>：当签名者与账户不匹配时抛出。</li>
</ul>
</li>
<li><p><strong>构造函数</strong>：</p>
<ul>
<li>初始化 <code>EIP712</code> 的域分隔符，使用传入的 <code>name</code> 参数，并设置版本号为 <code>&quot;1&quot;</code>。</li>
</ul>
</li>
<li><p><strong>permit 函数</strong>：</p>
<ul>
<li>验证签名是否过期。</li>
<li>生成 <code>Permit</code> 结构的哈希值。</li>
<li>使用 EIP-712 签名验证机制恢复签名者地址。</li>
<li>检查签名者是否与 <code>owner</code> 匹配。</li>
<li>调用 <code>_approve</code> 函数批准代币转移。</li>
</ul>
</li>
<li><p><strong>nonces 函数</strong>：</p>
<ul>
<li>返回指定账户的签名计数器值。</li>
</ul>
</li>
<li><p><strong>DOMAIN_SEPARATOR 函数</strong>：</p>
<ul>
<li>返回 EIP-712 的域分隔符。</li>
</ul>
</li>
</ol>
<h3 id="用途-3"><a href="#用途-3" class="headerlink" title="用途"></a>用途</h3><p><code>ERC20Permit</code> 合约允许用户通过签名来批准代币转移，而无需直接调用 <code>approve</code> 函数。这对于提高安全性（避免重放攻击）和用户体验（无需每次都手动批准）非常有用。</p>
<h3 id="注意事项-4"><a href="#注意事项-4" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li><strong>安全性</strong>：确保正确实现 EIP-712 签名验证，以防止签名被滥用。</li>
<li><strong>时间戳</strong>：使用 <code>block.timestamp</code> 来检查签名是否过期，确保安全性。</li>
<li><strong>nonce</strong>：使用 <code>nonce</code> 来防止重放攻击，确保每个签名只被使用一次。</li>
<li><strong>兼容性</strong>：确保合约与所有相关接口和标准兼容，以避免潜在的问题。</li>
</ol>
<h3 id="ERC-2612标准"><a href="#ERC-2612标准" class="headerlink" title="ERC-2612标准"></a>ERC-2612标准</h3><p>ERC-2612 标准提供了一种安全、高效的方式来授权代币转移，是 ERC-20 标准的一个扩展。它允许代币持有者通过签名授权第三方转移代币，而不需要直接调用 <code>approve</code> 函数。这个标准基于 EIP-712，它提供了一种使用签名来验证和执行操作的方法。</p>
<h4 id="ERC-2612-标准的主要功能"><a href="#ERC-2612-标准的主要功能" class="headerlink" title="ERC-2612 标准的主要功能"></a>ERC-2612 标准的主要功能</h4><ol>
<li><p><strong>Permit 函数</strong>：允许代币持有者通过签名授权第三方转移代币。这个函数需要三个参数：<code>owner</code>（代币持有者的地址）、<code>spender</code>（被授权的地址）和 <code>value</code>（被授权的代币数量）。</p>
</li>
<li><p><strong>EIP-712 签名</strong>：使用 EIP-712 签名来验证 <code>Permit</code> 函数的调用。EIP-712 是一种用于生成和验证签名的标准，它允许在签名中包含额外的元数据，如链 ID 和域分隔符。</p>
</li>
<li><p><strong>Nonce</strong>：每个账户都有一个关联的 <code>nonce</code> 值，用于防止重放攻击。在 <code>Permit</code> 函数中，<code>nonce</code> 值会自动增加，确保每个签名只被使用一次。</p>
</li>
</ol>
<h4 id="ERC-2612-标准的实现"><a href="#ERC-2612-标准的实现" class="headerlink" title="ERC-2612 标准的实现"></a>ERC-2612 标准的实现</h4><p>要实现 ERC-2612 标准，代币合约需要包含以下部分：</p>
<ol>
<li><p><strong>Permit 函数</strong>：实现 <code>Permit</code> 函数，用于处理签名授权。</p>
</li>
<li><p><strong>EIP-712 签名</strong>：实现 EIP-712 签名生成和验证机制。</p>
</li>
<li><p><strong>Nonce</strong>：管理每个账户的 <code>nonce</code> 值。</p>
</li>
<li><p><strong>DOMAIN_SEPARATOR</strong>：生成 EIP-712 签名的域分隔符。</p>
</li>
</ol>
<h4 id="ERC-2612-标准的用途"><a href="#ERC-2612-标准的用途" class="headerlink" title="ERC-2612 标准的用途"></a>ERC-2612 标准的用途</h4><p>ERC-2612 标准的主要用途是提高代币的安全性。通过使用签名来授权代币转移，可以防止重放攻击，并简化用户界面。此外，它还可以提高交易效率，因为用户不需要每次都手动批准代币转移。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ethereum/" rel="tag"># ethereum</a>
              <a href="/tags/solidity/" rel="tag"># solidity</a>
              <a href="/tags/openzeppelin/" rel="tag"># openzeppelin</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/11/25/blockchain/ethereum/erc-20/" rel="prev" title="ERC-20">
      <i class="fa fa-chevron-left"></i> ERC-20
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/11/28/blockchain/ethereum/solidity-security/" rel="next" title="solidity编程安全">
      solidity编程安全 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF%E7%9A%84%E5%90%88%E7%BA%A6%E5%92%8C%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.</span> <span class="nav-text">继承的合约和接口</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF%E9%A1%BA%E5%BA%8F"><span class="nav-number">1.1.</span> <span class="nav-text">继承顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF%E5%8E%9F%E5%88%99"><span class="nav-number">1.2.</span> <span class="nav-text">继承原则</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-number">2.</span> <span class="nav-text">构造函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E5%87%BD%E6%95%B0"><span class="nav-number">3.</span> <span class="nav-text">主要函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E5%87%BD%E6%95%B0"><span class="nav-number">4.</span> <span class="nav-text">内部函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">5.</span> <span class="nav-text">注意事项</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Context"><span class="nav-number"></span> <span class="nav-text">Context</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E9%80%94"><span class="nav-number">2.</span> <span class="nav-text">用途</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-1"><span class="nav-number">3.</span> <span class="nav-text">注意事项</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ERC20"><span class="nav-number"></span> <span class="nav-text">ERC20</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E7%BA%A6%E6%88%90%E5%91%98"><span class="nav-number">1.</span> <span class="nav-text">合约成员</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#transfer-transferFrom"><span class="nav-number">2.</span> <span class="nav-text">transfer &amp; transferFrom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#approve"><span class="nav-number">3.</span> <span class="nav-text">approve</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#decimals"><span class="nav-number">4.</span> <span class="nav-text">decimals</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ERC20Pausable"><span class="nav-number"></span> <span class="nav-text">ERC20Pausable</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-1"><span class="nav-number">1.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E9%80%94-1"><span class="nav-number">2.</span> <span class="nav-text">用途</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-2"><span class="nav-number">3.</span> <span class="nav-text">注意事项</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AccessManaged"><span class="nav-number"></span> <span class="nav-text">AccessManaged</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E7%BA%A6%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">合约结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-2"><span class="nav-number">2.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E9%80%94-2"><span class="nav-number">3.</span> <span class="nav-text">用途</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-3"><span class="nav-number">4.</span> <span class="nav-text">注意事项</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ERC20Permit"><span class="nav-number"></span> <span class="nav-text">ERC20Permit</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-3"><span class="nav-number">1.</span> <span class="nav-text">实现原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E9%80%94-3"><span class="nav-number">2.</span> <span class="nav-text">用途</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-4"><span class="nav-number">3.</span> <span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ERC-2612%E6%A0%87%E5%87%86"><span class="nav-number">4.</span> <span class="nav-text">ERC-2612标准</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ERC-2612-%E6%A0%87%E5%87%86%E7%9A%84%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="nav-number">4.1.</span> <span class="nav-text">ERC-2612 标准的主要功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ERC-2612-%E6%A0%87%E5%87%86%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.2.</span> <span class="nav-text">ERC-2612 标准的实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ERC-2612-%E6%A0%87%E5%87%86%E7%9A%84%E7%94%A8%E9%80%94"><span class="nav-number">4.3.</span> <span class="nav-text">ERC-2612 标准的用途</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">博</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">148</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">123</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">博</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'Iv1.9c9e3f90ac2cc9f9',
      clientSecret: '478f8511687999ac85664313c08c94a1420e13f6',
      repo        : 'zhoubofsy.github.io',
      owner       : 'zhoubofsy',
      admin       : ['zhoubofsy'],
      id          : '621383c2e77cb2afb387a753aba2f466',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
